### **主要研究问题**

当前以Pfirrman为代表的椎间盘分级系统，其根本缺陷在于分级结果与患者的真实临床症状（如疼痛、功能障碍）之间缺乏一致性。之前采用的传统的无监督方法本质上是在优化“影像形态的相似性”，而非“临床意义的相关性”，因此无法解决这一核心矛盾。

为解决此问题，本方案提出一个低风险的综合框架，旨在吸纳监督式学习和深度学习的优点，同时规避其在小样本数据上的致命缺陷。

### **创新点**

1.  **采纳“患者级”分析单位**：我们将不再孤立地分析单个椎间盘，而是将一位患者的所有腰椎间盘（L1/L2至L5/S1）作为一个整体进行分析。通过稳健的统计聚合方法（如 `max`, `mean`）将一个患者的多个椎间盘信息“扁平化”为一个单一的、高维的患者级特征向量。
2.  **采用适合小样本的网络模型**：小样本往往是医学图像研究的一个难题，训练复杂的神经网络（如GNN-MIL）具有极高的过拟合风险且其效果高度依赖不稳定的预训练。因此，我们采用针对小样本专门优化的模型：一种方法是带原型的神经加性模型（ProtoNAM），另一种是引入一个Teacher–Student 框架，Teacher 采用预训练的 TabPFN‑2.5 模型（这是今年发布在nature的最新成果），将 knowledge 蒸馏到对应的 student 模型上。
3.  **融合先进技术**：图像分割采用基于nnUNet的3D全自动医学图像分割模型：TotalSegmentator，在腰椎影像上表现出优异性能。特征分析的核心模型采用近两年发布的最新研究成果（如ProtoNAM、TabPFN‑2.5等等），数据预处理和后处理也采用高级的数据分析方法（如bootstrap、ElasticNet、CORAL等等），相较于传统方法有显著优势。

---

### **模块一：数据准备**

#### **A. 图像分割**

 利用现有的、预训练好的3D自动分割模型，对每一个患者的T2序列MRI进行处理，自动分割出5个腰椎间盘（L1/L2 至 L5/S1）、相关的椎体以及椎管内容物的3D感兴趣区域（ROI）。具体见群里文件<快速标注指南>。

#### **B.临床指标数据**

基于医院提供的患者报告结果，关注ODI等指数，将其分为若干个离散的有序等级。例如：
 *	0级（轻度残疾）：ODI $0\%-20\%$
 *	1级（中度残疾）：ODI $21\%-40\%$
 *	2级（重度残疾）：ODI $41\%-60\%$
 * 	3级（严重残疾/卧床）：ODI $>60\%$
 *  $\cdots$

此方法在小样本上相对稳健。


---

### **模块二：特征提取**

此模块的目标是为每一个独立的椎间盘ROI创建一个高维度的混合特征向量。具体内容见https://github.com/SgSc733/ivd_degeneration_analysis 项目 user_guide.md 的特征提取模块。

#### **A：可清晰解释的具体特征 ($F_{rad}$)**

 1.  **手动计算的特征**：计算如椎间盘高度指数 (DHI)、T2信号强度比率 (T2SI) 等具有明确生物学意义的特征。
 2.  **PyRadiomics特征**：利用 `PyRadiomics` 库提取标准化的3D特征，包括：
        *   **一阶统计特征**：描述体素强度的分布（如熵、偏度、峰度）。
        *   **3D形状特征**：描述ROI形态（如体积、球形度、扁平度）。
        *   **纹理特征**：量化组织异质性（如GLCM, GLRLM, GLSZM等）。
        *   **滤波后特征**：对原始图像应用小波和高斯拉普拉斯等滤波器后，再重复提取上述所有特征，以捕捉不同尺度和频率下的信息。


#### **B：深度学习特征 ($F_{deep}$)**

由于样本数量不多，我们不自行训练非监督模型，而是利用一个在大型的3D医学数据集上预训练好的深度学习模型，将其用作一个即插即用的特征提取器。


#### **C：张量分解特征 ($F_{tensor}$)**

* 一个3D MRI体数据本质上是一个三阶张量。张量分解方法，如Tucker分解或CP分解，可以将这个高维张量因子分解为一个“核心张量”和一组因子矩阵。 张量分解是原生的3D（或N-D）方法，它能在不依赖卷积假设的情况下，捕捉多维数据间的相关性。它在特征提取和降维方面非常有效，并且在处理小样本、高维度数据集时显示出潜力。输出的这个核心张量和/或因子矩阵，即是原始数据的一种高度压缩的、结构化的特征表示。


#### **D. 节点特征拼接**

*   **任务**：对于数据库中的每一个椎间盘，将其流A和流B的计算结果在维度上进行拼接。
*   **输出**：对于一个有5个椎间盘的患者，我们现在拥有5个高维的（例如 1600 + 128 + 100 = 1828维）混合特征向量。
    $$F_{node} = \text{Concatenate}(F_{rad}, F_{deep}, F_{tensor})$$


---

### **模块三：特征分析**

这一步是要从提取到的特征中设计出新的可视化分级系统，相当于做一个纯粹的数据分析。具体方案见：方案1 https://4bjw16-my.sharepoint.com/:t:/g/personal/sgsc_4bjw16_onmicrosoft_com/EVBaL_7T8FNAjeHpVqNZEh4BTPXi711pF6Pc01Xz0_AZEw?e=zPnObO ；方案2 https://4bjw16-my.sharepoint.com/:t:/g/personal/sgsc_4bjw16_onmicrosoft_com/EVOT53eGCANOspE0rOPCWIABOlUUQuSlYXzZdE0HKarOSQ?e=8D886P。

注：以上md文件建议用vscode等软件渲染查看。